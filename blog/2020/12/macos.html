<!DOCTYPE html>
<html lang="zh_CN">
<head>
<!-- 2020-12-18 Fri 16:08 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>macos配置</title>
<meta name="generator" content="Org mode">
<meta name="author" content="albert">
<link rel="stylesheet" type="text/css" href="/main.css" />
</head>
<body>
<div id="content">
<h1 class="title">macos配置</h1>
<p>
最近在玩黑苹果，记录一些macos上的修改过的配置。
</p>

<h2>emacs设置</h2>



<h3>字体问题 <span class="timestamp-wrapper"><span class="timestamp">[2020-11-22 Sun 10:12]</span></span></h3>

<ul class="org-ul">
<li>在使用了 <code>hidpi.sh</code> 后，1440*810的分辨率， <code>Ubuntu mono 18</code> + PingFang字体(默认)，显示效果完美。</li>
</ul>

<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-12-07 Mon 13:03] </span></span> 用1920x1080比较好，hidpi会导致virtualbox的显示有问题。
</p>
<ul class="org-ul">
<li>目前在 <code>1920x1080</code> 分辨率下，用 <code>Ubuntu Mono 22 + 等距更纱黑体 T SC</code> ，效果很好。</li>
</ul>

<h3>最大化 - ok <span class="timestamp-wrapper"><span class="timestamp">[2020-11-22 Sun 23:28]</span></span></h3>

<div class="org-src-container">
<pre class="src src-lisp">(<span style="color: #00bfff;">if</span> (or (eq system-type 'windows-nt) (eq system-type 'darwin))
    (toggle-frame-maximized))
</pre>
</div>


<h3>注释 - ok</h3>

<div class="org-src-container">
<pre class="src src-lisp">(<span style="color: #00bfff;">when</span> (or IS-WINDOWS (eq window-system 'x) (eq system-type 'darwin))
  (global-set-key [?\C-c ?\C-/] 'comment-or-uncomment-region))
</pre>
</div>


<h3>path设置，ag - ok</h3>

<p>
macos里的emacs启动时，没法继承shell里面的 <code>PATH</code> ，需要package <code>exec-path-from-shell</code> ，感觉有点搞笑。
</p>
<div class="org-src-container">
<pre class="src src-lisp">(use-package exec-path-from-shell
  <span style="color: #f08080;">:if</span> (memq window-system '(ns mac))
  <span style="color: #f08080;">:ensure</span> t
  <span style="color: #f08080;">:config</span>
  <span style="color: #B0BED8;">;; </span><span style="color: #B0BED8;">(setq exec-path-from-shell-arguments '("-l"))</span>
  (exec-path-from-shell-initialize))
</pre>
</div>


<h3>org template - ok</h3>

<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #B0BED8;">;; </span><span style="color: #B0BED8;">emacs 28 comes with org version 9.3</span>
<span style="color: #B0BED8;">;; </span><span style="color: #B0BED8;">org-mode&#30340;&lt;s &lt;Tab&gt; &#34917;&#20840;&#19981;&#27491;&#24120;&#12290;</span>
<span style="color: #B0BED8;">;; </span><span style="color: #B0BED8;">https://orgmode.org/Changes.html</span>

<span style="color: #B0BED8;">;; </span><span style="color: #B0BED8;">&#19981;&#33021;&#29992;org-version&#26469;&#21028;&#26029;&#65292;&#36825;&#26102;org&#36824;&#27809;&#21551;&#21160;</span>
(<span style="color: #00bfff;">when</span> (&gt;= emacs-major-version 27)
  (<span style="color: #00bfff;">defvar</span> <span style="color: #4eee94;">org-modules</span>
    '(org-tempo
      )))
</pre>
</div>


<h3>中英文切换 <span class="timestamp-wrapper"><span class="timestamp">[2020-11-23 Mon 00:17]</span></span></h3>

<p>
用了 <code>sis</code> ，效果不好，看来我要自己写代码解决了吗？从 <code>emacs mac port</code> ，借鉴了一些代码，改了以后切换ok，就是不能像在win10里面一样，有时候会记不住中英文输入法的状态。
</p>


<h3>make <span class="timestamp-wrapper"><span class="timestamp">[2020-12-02 Wed 10:03]</span></span></h3>

<div class="org-src-container">
<pre class="src src-sh">brew install autoconf automake pkg-config libxml2
</pre>
</div>

<h3>cpu高问题 - helm导致 <span class="timestamp-wrapper"><span class="timestamp">[2020-12-10 Thu 08:28]</span></span></h3>

<p>
昨天下午发现emacs的cpu十分不正常，打开org mode后，文件不大，cpu就很高。定位是helm的问题。已经去掉helm，用ivy代替后，cpu在闲时会到0%。
</p>

<p>
为什么在win10和linux上没发现helm导致cpu高的问题？
</p>


<h3>emacs mac port <span class="timestamp-wrapper"><span class="timestamp">[2020-12-10 Thu 08:30]</span></span></h3>

<p>
不是很好用，还是用 <code>emacsformac</code> 或者直接源代码编译吧。
</p>

<ul class="org-ul">
<li>meta key在哪里的问题</li>
</ul>

<h3>byte-recompile-directory <span class="timestamp-wrapper"><span class="timestamp">[2020-12-10 Thu 13:58]</span></span></h3>

<p>
这个命令不是简单的敲进去就可以用的。如果你发现直接使用是提示“编译0个文件”就是说没有合适的文件被编译。在stackoverflow上面的另外一篇文章很好的解释了这个问题，<a href="http://stackoverflow.com/questions/1217180/how-do-i-byte-compile-everything-in-my-emacs-d-directory">http://stackoverflow.com/questions/1217180/how-do-i-byte-compile-everything-in-my-emacs-d-directory</a> 。
</p>

<p>
<code>C-u 0 M-x byte-recompile-directory</code> 才可以。
</p>

<h2>sshpass - ok <span class="timestamp-wrapper"><span class="timestamp">[2020-11-29 Sun 16:44]</span></span></h2>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">&#30001;&#20110;&#23433;&#20840;&#21407;&#22240;&#65292;brew&#19981;&#20801;&#35768;&#23433;&#35013;sshpass&#65292;&#30452;&#25509;&#28304;&#20195;&#30721;&#32534;&#35793;</span>
brew install sshpass
</pre>
</div>

<p>
<a href="https://stackoverflow.com/questions/32255660/how-to-install-sshpass-on-mac">https://stackoverflow.com/questions/32255660/how-to-install-sshpass-on-mac</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">curl -O -L https://sourceforge.net/projects/sshpass/files/sshpass/1.06/sshpass-1.06.tar.gz &amp;&amp; tar xvzf sshpass-1.06.tar.gz
<span style="color: #f08080;">cd</span> sshpass-1.06
./configure
sudo make install
</pre>
</div>

<h2>zsh配置 <span class="timestamp-wrapper"><span class="timestamp">[2020-12-18 Fri 09:56]</span></span></h2>

<p>
从10.15.1 <code>catalina</code> 开始，水果推荐使用zsh做为默认shell，bash已不推荐。
</p>

<p>
zsh在使用 <code>vi mode</code> 后，和bash的差别不大，bash的问题是打开关闭几次tab后， <code>history</code> 就没有了，很奇怪。而zsh就可以保留。
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #f08080;">export</span> <span style="color: #4eee94;">PATH</span>=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin

<span style="color: #f08080;">set</span> -o vi

<span style="color: #f08080;">export</span> <span style="color: #4eee94;">CLICOLOR</span>=1

<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">for bash</span>
<span style="color: #B0BED8;">#</span><span style="color: #B0BED8;">PS1='\n\e[1;37m[\e[m\e[1;32m\u\e[m\e[1;33m@\e[m\e[1;35m\H\e[m \e[4m`pwd`\e[m\e[1;37m]\e[m\e[1;36m\e[m\n\$'</span>

<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">for zsh</span>
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">&#27880;&#24847;&#31561;&#21495;&#21518;&#38754;&#30340;$</span>
<span style="color: #B0BED8;">#</span><span style="color: #B0BED8;">PROMPT=$'[%n@%m %~]\n$'</span>

<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">for i in {1..256}; do print -P "%F{$i}Color : $i"; done;</span>
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">PROMPT=$'[%F{28}%n%F{reset}%F{11}@%F{reset}%F{13}%m%F{reset} %~]\n$'</span>
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">green=28, yellow=11, magenta=13</span>
<span style="color: #4eee94;">PROMPT</span>=$<span style="color: #deb887;">'[%F{green}%n%F{reset}%F{yellow}@%F{reset}%F{magenta}%m%F{reset} %d]\n$'</span>
</pre>
</div>

<h2>服务优化</h2>



<h3>mds和spotlight <span class="timestamp-wrapper"><span class="timestamp">[2020-12-18 Fri 10:28]</span></span></h3>

<p>
MacOS中, mds_stores进程CPU高的问题
</p>

<ul class="org-ul">
<li><p>
mds
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">&#20851;&#38381;</span>
sudo mdutil -a -i off

<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">&#25171;&#24320;</span>
sudo mdutil -a -i on
</pre>
</div></li>

<li><p>
spotlight
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">&#20851;&#38381;</span>
sudo launchctl unload -w /System/Library/LaunchAgents/com.apple.Spotlight.plist

<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">&#25171;&#24320;</span>
sudo launchctl load -w /System/Library/LaunchAgents/com.apple.Spotlight.plist
</pre>
</div></li>

<li><p>
mds_stores
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">&#20851;&#38381;</span>
sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist

<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">&#25171;&#24320;</span>
sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist
</pre>
</div></li>
</ul>


<h3>Speed Up Mojave Mac OS <span class="timestamp-wrapper"><span class="timestamp">[2020-12-18 Fri 12:05]</span></span></h3>



<h4>Graphics related and User Interface related</h4>

<p>
These are all useless effects for dock sliding in and delays before something opens up. You can just paste these lines one-by-one into the terminal window.
</p>

<div class="org-src-container">
<pre class="src src-sh">defaults write NSGlobalDomain NSAutomaticWindowAnimationsEnabled -bool false
defaults write NSGlobalDomain NSWindowResizeTime -float 0.001
defaults write -g QLPanelAnimationDuration -float 0
defaults write com.apple.dock autohide-time-modifier -float 0
defaults write com.apple.dock launchanim -bool false
sudo sysctl debug.lowpri_throttle_enabled=0
</pre>
</div>

<p>
You will need the admin password for commands starting with “sudo”
</p>


<h4>General Services that are useless</h4>

<p>
Please just copy and paste these lines into the terminal – as you can see they are just update helpers and other useless services
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">ok</span>
sudo launchctl remove com.apple.CallHistoryPluginHelper
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not started</span>
sudo launchctl remove com.apple.AddressBook.abd
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">ok</span>
sudo launchctl remove com.apple.ap.adprivacyd
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">ok</span>
sudo launchctl remove com.apple.ReportPanic
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not found</span>
sudo launchctl remove com.apple.ReportCrash
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not found</span>
sudo launchctl remove com.apple.ReportCrash.Self
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not started</span>
sudo launchctl remove com.apple.DiagnosticReportCleanup.plist
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not started</span>
sudo launchctl remove com.apple.siriknowledged
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not started</span>
sudo launchctl remove com.apple.helpd
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not started</span>
sudo launchctl remove com.apple.mobiledeviceupdater
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not started</span>
sudo launchctl remove com.apple.screensharing.MessagesAgent
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not started</span>
sudo launchctl remove com.apple.TrustEvaluationAgent
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not found</span>
sudo launchctl remove com.apple.iTunesHelper.launcher
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">not found</span>
sudo launchctl remove com.apple.softwareupdate_notify_agent
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">ok</span>
sudo launchctl remove com.apple.appstoreagent
<span style="color: #B0BED8;"># </span><span style="color: #B0BED8;">ok</span>
sudo launchctl remove com.apple.familycircled
</pre>
</div>

<p>
At any given time you can see by typing
</p>
<div class="org-src-container">
<pre class="src src-sh">launchctl list
</pre>
</div>

<p>
to see what your computer is loading.
</p>

<p>
If you don’t use Safari which I encourage people not to because it is slow and doesn’t honour many of the industry standards for HTML5.
</p>


<h5>For Users not using Safari</h5>

<p>
Please just copy and paste these lines into the terminal – as you can see they are just update helpers and other useless services
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo launchctl remove com.apple.SafariCloudHistoryPushAgent
sudo launchctl remove com.apple.Safari.SafeBrowsing.Service
sudo launchctl remove com.apple.SafariNotificationAgent
sudo launchctl remove com.apple.SafariPlugInUpdateNotifier
sudo launchctl remove com.apple.SafariHistoryServiceAgent
sudo launchctl remove com.apple.SafariLaunchAgent
sudo launchctl remove com.apple.SafariPlugInUpdateNotifier
sudo launchctl remove com.apple.safaridavclient
</pre>
</div>

<p>
I have not gone through all of the services that are run on start up – I’m sure there are plenty of other processes there that slow your computer down.
</p>

<p>
I hope this helps!
</p>

<p>
I found this article quite useful: <a href="https://www.lifewire.com/terminal-tricks-to-speed-up-your-mac-4120954">https://www.lifewire.com/terminal-tricks-to-speed-up-your-mac-4120954</a>
</p>


<h3>如何关掉com.apple.ReportCrash <span class="timestamp-wrapper"><span class="timestamp">[2020-11-29 Sun 23:07]</span></span></h3>

<ul class="org-ul">
<li>关闭</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">launchctl unload -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist
</pre>
</div>

<ul class="org-ul">
<li><p>
打开 
</p>
<div class="org-src-container">
<pre class="src src-sh">launchctl load -w /System/Library/LaunchAgents/com.apple.ReportCrash.plist
sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.ReportCrash.Root.plist
</pre>
</div></li>
</ul>
</div>
</body>
</html>
